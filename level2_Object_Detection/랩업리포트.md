# Wrap-Up report

# 1. í”„ë¡œì íŠ¸ ê°œìš”


ğŸ“Œ **í”„ë¡œì íŠ¸ ê°œìš”**

***Problem Type.*** ì‚¬ì§„ ë‚´ ì“°ë ˆê¸° 10ì¢…ì— ëŒ€í•œ Object Detection  
***Metric.*** mAP50(Mean Average Precision)  
***Data.*** 9754ì¥ (1024, 1024) 10 classes  
***class.*** General trash, Paper, Paper pack, Metal, Glass, 
          Plastic, Styrofoam, Plastic bag, Battery, Clothing



ğŸ“Œ **ê°œë°œí™˜ê²½ & í˜‘ì—…íˆ´**

- **ê°œë°œí™˜ê²½**
    
    
    | ê°œë°œí™˜ê²½  | ë²„ì „ | ê°œë°œí™˜ê²½  | ë²„ì „ |
    | --- | --- | --- | --- |
    | GPU | V100 | PyTorch (GPU) | 1.7.1 |
    | CUDA  | 11.0 | mmdetection | 2.22.0  |
    | Python | 3.8.5 | mmcv | 1.4.6  |
    | VSCode | 1.60.0 | detectron2 | 0.5 |
    
- **í˜‘ì—… Tool**
    - ì½”ë“œ ê´€ë¦¬ â†’ [GitHub](https://github.com/boostcampaitech3/level2-object-detection-level2-cv-15/)
    - ëª¨ë¸ ê´€ë¦¬ â†’ [WandB](https://wandb.ai/boostcampaitech3)
    - ê¸°íƒ€ ê´€ë¦¬ â†’ [GoogleSheet](https://docs.google.com/spreadsheets/d/1ZHDPXaJsifjHqrIRRUDGXL_UoGHWZPOl_7RcMT0D6Ik/edit#gid=84729316)


# 2. íŒ€ êµ¬ì„± ë° ì—­í• 

ğŸ“Œ  ì„œë¡œ ë‹¤ë¥¸ ëª¨ë¸ì— ë§ëŠ” augmentation ë° ìµœì í™” ë°©ì‹ì„ ì°¾ê³ , ì•™ìƒë¸” ê¸°ë²•ìœ¼ë¡œ í•©ì³ì„œ

- 1 stage - ì†ì •ê· , ë°•ì •í˜„, ì´í˜„ì§„
- 2 stage - ê¹€ê·œë¦¬, ì„ì¢…í˜„, ì„ì§„í˜


ğŸ“Œ **Workspace file & directory**

***MMDetection***

```
detection/
â”œâ”€â”€ ğŸ“‚ baseline/mmdetection
â”‚   â”œâ”€â”€ ğŸ“‚Â configs
â”‚   â”‚   â”œâ”€â”€ ğŸ“‚_base_
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“‚datasets
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ğŸ“Â coco_detection.py
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“‚models
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ğŸ“Â faster_rcnn_r50_fpn.py
â”‚   â”‚   â”‚   â”‚   â””â”€â”€...
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“‚schedules
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ğŸ“Â schedule_3x_cosinerestart.py
â”‚   â”‚   â”‚   â”‚   â””â”€â”€...
â”‚   â”‚   â”‚   â””â”€â”€ ğŸ“Â default_runtime.py
â”‚   â”‚   â”œâ”€â”€ ğŸ“‚cascade_rcnn
â”‚   â”‚   â”œâ”€â”€ ğŸ“‚universenet
â”‚   â”‚   â”œâ”€â”€ ...
â”‚   â”œâ”€â”€ ğŸ“‚Â works_dir
â”‚   â”‚   â”œâ”€â”€ ğŸ“‚cascade_rcnn
â”‚   â”‚   â”œâ”€â”€ ğŸ“‚universenet
â”‚   â”‚   â”œâ”€â”€ ...
â”‚   â””â”€â”€ ğŸ“‚Â tools
â”‚       â”œâ”€â”€ ğŸ“‚ensemble
â”‚       â”‚   â”œâ”€â”€ ğŸ“Â ensemble.py
â”‚       â”‚   â””â”€â”€ ğŸ“Â ensemble_config.py
â”‚       â”œâ”€â”€ ğŸ“ train.py
â”‚       â”œâ”€â”€ ğŸ“ test.py
â”‚       â”œâ”€â”€ ğŸ“ dist_train.sh
â”‚       â”œâ”€â”€ ğŸ“ dist_test.sh
â”‚       â””â”€â”€ ğŸ“ dataVisualization.ipynb
â””â”€â”€ ğŸ“‚ dataset/
    â”œâ”€â”€ ğŸ“‚ stratified/
    â”œâ”€â”€ ğŸ“‚Â data_cleaned/
		â””â”€â”€ ğŸ“‚ pseudo/

```

ğŸ“Œ **Workspace file & directory**

***Yolov5***

```
yolov5/
â”‚
â”œâ”€â”€ ğŸ“‚ data/
|   â”œâ”€â”€ ğŸ“‚ hyps/
â”‚   â”‚   â””â”€â”€ ğŸ“ hyp.myhyp.yaml
â”‚   â”œâ”€â”€ ğŸ“ coco.yaml
â”‚   â””â”€â”€ ğŸ“ custom_dataset.yaml
â”‚    
â”œâ”€â”€ ğŸ“‚ models/
|   â”œâ”€â”€ ğŸ“‚ hubs/
â”‚   â”‚   â””â”€â”€ ğŸ“ yolov5x6.yaml
â”‚   â”œâ”€â”€ ğŸ“ __init__.py
â”‚   â”œâ”€â”€ ğŸ“ common.py
â”‚   â”œâ”€â”€ ğŸ“ experimental.py
â”‚   â”œâ”€â”€ ğŸ“ tf.py
â”‚   â”œâ”€â”€ ğŸ“ yolo.py
â”‚   â””â”€â”€ ğŸ“ yolov5x.yaml
â”‚
â”œâ”€â”€ ğŸ“‚ utils/
â”‚   â”œâ”€â”€ ğŸ“ activations.py
â”‚   â”œâ”€â”€ ğŸ“ augmentations.py
â”‚   â”œâ”€â”€ ğŸ“ datasets.py
â”‚   â”œâ”€â”€ â‹¯
â”‚   â”œâ”€â”€ ğŸ“ loss.py
â”‚		â””â”€â”€ ğŸ“ metrics.py
â”‚
â”œâ”€â”€ ğŸ“ detect.py 
â”œâ”€â”€ ğŸ“ train.py 
â””â”€â”€ ğŸ“ val.py 

```

# 3. í”„ë¡œì íŠ¸ ìˆ˜í–‰ ì ˆì°¨ ë° ë°©ë²•

ëª¨ë¸ë§ â†’ EDA â†’ ì „ìˆ˜ì¡°ì‚¬ â†’ ëª¨ë¸ë§ â†’ ìˆ˜ë„ë¼ë²¨ë§


â­• ***1. EDA***

- í•œ ì´ë¯¸ì§€ë‹¹ ë°•ìŠ¤ ê°¯ìˆ˜
    
   <p align='center'><img src="https://user-images.githubusercontent.com/57162812/162646616-1d61f4c6-b587-48e6-be41-45d86c267b2c.png" width="50%"></p>

    
    [red] 25%, [yellow] 50%, [green] 75%, [blue] 100%
    
- bboxì˜ ê°€ë¡œ ì„¸ë¡œ ë¹„ìœ¨
    
    <p align='center'><img src="https://user-images.githubusercontent.com/57162812/162646877-a7880b51-0a03-4045-918f-898baab923f3.png" width="50%"></p>
    
    [red] width, [blue] height
    
- out-lier í™•ì¸



â­• ***2. Data ì „ìˆ˜ ì¡°ì‚¬***

- ë°ì´í„° ì „ìˆ˜ì¡°ì‚¬ : ì„ì˜ë¡œ ì“°ë ˆê¸°ë¥¼ íŒë‹¨í•˜ê¸°ë³´ë‹¤ ë‹¤ë¥¸ ë°ì´í„°ì™€ ìœ ì‚¬ë„ë¥¼ ê³ ë ¤í•´ ìˆ˜ì •
[https://docs.google.com/spreadsheets/d/1ZHDPXaJsifjHqrIRRUDGXL_UoGHWZPOl_7RcMT0D6Ik/edit#gid=84729316](https://docs.google.com/spreadsheets/d/1ZHDPXaJsifjHqrIRRUDGXL_UoGHWZPOl_7RcMT0D6Ik/edit#gid=84729316)
- mislabeling : ë‹¤ë¥¸ ì´ë¯¸ì§€ì™€ ë¼ë²¨ë§ íŒ¨í„´ì´ ìƒì´í•  ë•Œ (52ì¥)
    
    <p align='center'><img src="https://user-images.githubusercontent.com/57162812/162646910-e2e30672-c681-45da-ab07-9366e4b410ae.png" width="50%"></p>
    
- erase : ì“°ë ˆê¸°ì— bounding boxê°€ ê·¸ë ¤ì ¸ ìˆì§€ ì•Šê³ , labelì„ íŒë‹¨í•˜ê¸° í˜ë“¤ ë•Œ(65ì¥)
[https://cleanup.pictures/](https://cleanup.pictures/)
    
    <p align='center'><img src="https://user-images.githubusercontent.com/57162812/162646928-7eb76dcd-dc87-4a9d-8e99-0e90c77a3ccd.png" width="50%"></p>
    

â­• ***3. Cross Validation***

- StraitifiedGroupK-fold
- ê°œì„ í•´ì•¼í•  ì 
    - StratifiedGroupK-Foldê¸°ë²•ì„ í†µí•´ ì´ë¯¸ì§€ idì™€ category idë¥¼ ì„¸íŠ¸ë³„ë¡œ ê· ì¼í•˜ê²Œ ë‚˜ëˆ´ëŠ”ë°, ì‘ì€ ë°•ìŠ¤ë“¤ì´ë‚˜ ì´ë¯¸ì§€ ë‹¹ bbox ê°œìˆ˜ë„ ì„¸íŠ¸ ë³„ë¡œ ê· ì¼í•˜ê²Œ ë‚˜ëˆ ì¡Œë‹¤ë©´ ë” ì¢‹ì§€ ì•Šì•˜ì„ê¹Œ?
        
        ![Untitled](Wrap-Up%20re%20886bf/Untitled%204.png)
        

â­• **4*. Modeling***

- backbone :  resnet50, resnext101, pvt2, swin-t, swin-L,
- neck : fpn, pafpn, rfp, sepc
- 1_Stage_Detector : YOLOv5, UniverseNet, EfficientDet
- 2_Stage_Detector : CascadeRCNN, FasterRCNN, DETR, DynamicHead

â­• **5*. Data Augmentation***

- mix_up
- cut_mix
- Multi_scale
- others : flip, rotate

â­• **6*. TTA & ensemble & Pseudo Labeling***

- TTA : Flip, Resize
- Ensemble : NMS, WBF
- Pseudo Labeling
    - LBscoreê¸°ì¤€ ìµœê³ ì ìˆ˜ì¸ ì œì¶œ ê²°ê³¼ì˜ label ì¤‘ confidence scoreê°€ 0.35ì´ìƒì— ëŒ€í•´.


# 4. í”„ë¡œì íŠ¸ ìˆ˜í–‰ ê²°ê³¼

â­• ***ëª¨ë¸ ì„ ì • ë° ë¶„ì„***

1. ***Cascade RCNN***
    - LBscore : 0.6179 â†’ 0.6037
    - backbone : swin tiny
    - neck : pafpn
    - Training Time Augmentation
        - FlipRandomRotate90,
        - RandomResizedCrop
        - RamdomBrightnessContrastHueSaturationValue
        - GaussNoise
        - Blur/GaussianBlur/MedianBlur/MotionBlur
    - Img_size : multi-scale 512 ~ 1024
    - Optimizer
        - type='AdamW', lr=0.0001, betas=(0.9, 0.999), weight_decay=0.05
    - Scheduler
        - CosineRestart 3x
    - TTA
        - multi-scale, flip
    - ê¸°íƒ€ ì‹œë„
        - Rpn head scale & ratio
        - Roi Head- number of stages, iou threshold
        - multi scale range/value
        - backbone(detectoRS, resnet50, pvt2, swin-t, swin-L)
        - neck(fpn, rfp, nasfpn, pafpn)
2. ***Yolov5***
    - LBscore : 0.5711
    - Training Time Augmentation
        - Flip / RandomRotate90
        - RandomBrightnessContrast
        - GaussNoise
        - Blur / GaussianBlur / MedianBlur / MotionBlur
        - CLAHE
    - Img_size : 1024 x 1024
    - Optimizer : SGD
    - Scheduler : LambdaLR with one_cycle
    - TTA
        - Flip
        - Multi Scale
    - ê¸°íƒ€ ì‹œë„
        - background ì œê±° : í•œ ì´ë¯¸ì§€ì˜ ëª¨ë“  bboxë¥¼ í¬í•¨í•˜ëŠ” boxë¥¼ ì œì™¸í•œ ë¶€ë¶„ì€ black ì²˜ë¦¬í–ˆë‹¤.
        - psuedo labeling : í•™ìŠµ weightì— ëŒ€í•´ì„œ confidence thresholdë¥¼ 0.8ë¡œ ì£¼ì–´ test imageì— ëŒ€í•´ì„œ labeling í•´ì£¼ì—ˆë‹¤. í•˜ì§€ë§Œ, confidence thresholdê°€ ë„ˆë¬´ ë†’ì•„ labeling ë˜ì§€ ì•ŠëŠ” objectê°€ ë§ì•„ì„œ í•™ìŠµì— ë°©í•´ë˜ëŠ” ê²ƒ ê°™ì•˜ë‹¤.
3. ***UniverseNet*** 
    - LBscore : 0.6110 â†’ 0.5890
    - Training Time Augmentation
        - Flip, RandomRotate90,
        - RamdomBrightnessContrast, HueSaturationValue
        - GaussNoise
        - Blur/GaussianBlur/MedianBlur/MotionBlur
    - Img_size : multi scale 512~2048
    - Optimizer : SGD lr-0.002, momentum=0.9, weight_decay=0.0001
    - Scheduler : CosineAnnealing
    - ê¸°íƒ€ ì‹œë„


# 5. ìì²´ í‰ê°€ ì˜ê²¬


â­•  **ì˜í•œ ì ë“¤**

- ê°€ëŠ¥í•œ í•œ ë‹¤ì–‘í•œ model, backbone ê·¸ë¦¬ê³  ê¸°íƒ€ ë‹¤ì–‘í•œ ë°©ë²•ë¡  ì‹œë„.
- github, WandB, notion ë“±ì„ ì´ìš©í•œ ì‹¤í—˜ê´€ë¦¬ ë° í˜‘ì—…
- íŒ€ì›ì´ í•˜ë‚˜ê°€ ë˜ì–´ì„œ ë°ì´í„° ì „ìˆ˜ì¡°ì‚¬!!
- ì•™ìƒë¸” , TTAë“± ê¸°ë²•ë“¤ì„ í†µí•œ ì„±ëŠ¥í–¥ìƒ!
- ì–¸ì œë‚˜ ë„ì›€ì„ ì£¼ëŠ” íŒ€ì›ë“¤ ìƒì‹œ ëŒ€ê¸°ì¤‘. ì¤Œì„ í†µí•œ ì‹¤ì‹œê°„ ìƒí™© ê³µìœ .

â­• **ì•„ì‰¬ì› ë˜ ì ë“¤**

- ë¯¸ë¦¬ 5ê°œ foldë¡œ datasetì¤‘ testì…‹ê³¼ ì˜ë§ëŠ” foldë¥¼ í™•ì¸í•´ ë³´ì§€ ëª»í•œ ê²ƒ
- upsamplingì˜ ì œëŒ€ë¡œ ëœ ì ìš©ì„ ëª»í•œê²ƒ
- detectron ì‚¬ìš©ì˜ ë¶€ì¬
- í•™ìŠµê³¼ ëŒ€íšŒì˜ ë³‘í–‰ì´ ì–´ë ¤ì› ë‹¤.
- ëª¨ë¸ ë³„ë¡œ ì—­í• ë¶„ë‹´ì„ í–ˆëŠ”ë°, loss, optimizer, augmentation ë“± ë‹¤ë¥¸ ì„¸ë¶€ ì‚¬í•­ì— ëŒ€í•´ì„œë„ ì—­í• ë¶„ë‹´ì„ í•´ë³´ì.
- ëª¨ë¸ì„œì¹˜ì™€ ì‹¤í—˜ê´€ë¦¬ë¥¼ ìë™í™” í•  ìˆ˜ ìˆëŠ” íˆ´ì„ ì‚¬ìš©í–ˆë‹¤ë©´ í”„ë¡œì íŠ¸ë¥¼ íš¨ìœ¨ì ìœ¼ë¡œ ì§„í–‰í•  ìˆ˜ ìˆì§€ ì•Šì•˜ì„ê¹Œ?

â­• **ì‹œë„ í–ˆìœ¼ë‚˜ ì˜ ë˜ì§€ ì•Šì•˜ë˜ ê²ƒë“¤**

- Semi-supervied Object Detection SOTA(coco 100%)ì¸ Soft Teacherë¥¼ ì‹œë„í–ˆìœ¼ë‚˜ ë””ë²„ê¹…ì— ë§ì€ ì‹œê°„ ì†Œìš”. ê²°ê³¼ì ìœ¼ë¡  GPU ë° ì‹œê°„ ìƒ í•œê³„ë¡œ ì¸í•´ í•™ìŠµì„ ë§ˆì¹˜ì§€ ëª»í•¨.
- backgroundë¥¼ ì œê±°í•´ë³´ì•˜ì§€ë§Œ ì„±ëŠ¥ì´ ì˜¤íˆë ¤ ë–¨ì–´ì¡Œë‹¤.
- ì´ë¯¸ì§€ ë‹¹ bounding box ê°œìˆ˜, bounding box í¬ê¸° ë“± outlierë¡œ íŒë‹¨ë˜ëŠ” ê²ƒë“¤ì„ ì œê±°í•´ë´¤ëŠ”ë° ì„±ëŠ¥ì˜ ë³€í™”ëŠ” ì—†ì—ˆë‹¤.

â­• **í”„ë¡œì íŠ¸ë¥¼ í†µí•´ ë°°ìš´ ì  ë˜ëŠ” ì‹œì‚¬ì **

- Object Detection taskì˜ í”„ë¡œì„¸ìŠ¤ë¥¼ ì´í•´í•˜ê³ , ì´í›„ ê°™ì€ ìœ í˜•ì˜ ê²½ì§„ ëŒ€íšŒì— ì°¸ì—¬í•  ìˆ˜ ìˆëŠ” ì—­ëŸ‰ ë§ˆë ¨
- ì œê³µëœ ë°ì´í„° í’ˆì§ˆì— ëŒ€í•œ í‰ê°€ ë° ê°œì„ í•˜ëŠ” ê³¼ì •ì„ í†µí•´ì„œ ë°ì´í„° ì´ìŠˆ í•´ê²°ì— ëŒ€í•œ ì´í•´ë¥¼ ë†’ì„
- ê°€ë²¼ìš´ ëª¨ë¸ë¡œ loss, optimizer ë“± ì‹¤í—˜ì„ ë‹¤ í•´ë³´ê³  ë¬´ê±°ìš´ ëª¨ë¸ì„ ëŒë¦¬ì.
- í•˜ë‚˜ì˜ imageì— ì—¬ëŸ¬ê°œì˜ labelì´ í¬í•¨ë˜ì–´ìˆëŠ” Multi-labelì¸ ê²½ìš°ì—ëŠ” StratifiedGroupK-fold ë°©ì‹ìœ¼ë¡œ CrossValidationì„ í•˜ì.
